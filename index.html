<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALIBRATION TFS TOOLS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', 'Noto Sans Thai', sans-serif; }
        :root { --brand-red: #d52b1e; --brand-black: #1a1a1a; }

        /* Schindler Theme Elements */
        .box-normal { background: white; border: 2px solid #10b981; box-shadow: 6px 6px 0px 0px #059669; transition: 0.2s; }
        .box-warning { background: #fffbeb; border: 2px solid #f59e0b; box-shadow: 6px 6px 0px 0px #d97706; transition: 0.2s; }
        .box-overdue { background: #fef2f2; border: 2px solid #ef4444; box-shadow: 6px 6px 0px 0px #dc2626; transition: 0.2s; }
        .box-normal:hover, .box-warning:hover, .box-overdue:hover { transform: translate(-2px, -2px); }

        .btn-3d { transition: 0.15s; box-shadow: 3px 3px 0px 0px rgba(0,0,0,0.2); }
        .btn-3d:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px 0px rgba(0,0,0,0.2); }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #d52b1e; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-down { animation: slideDown 0.3s ease-out forwards; }

        /* Manual Styling */
        .manual-section h3 { font-weight: 800; color: var(--brand-red); margin-top: 1rem; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .manual-section ul { list-style: disc; padding-left: 1.25rem; margin-top: 0.5rem; }
    </style>
</head>
<body class="h-full bg-slate-50 text-gray-800">

    <div id="app" class="min-h-full flex flex-col max-w-7xl mx-auto">
        <!-- HEADER -->
        <header class="bg-white border-b-4 border-[--brand-red] shadow-sm sticky top-0 z-40">
            <div class="px-4 py-4">
                <div class="flex justify-between items-start mb-3">
                    <div class="flex items-start gap-3">
                        <div class="w-12 h-12 min-w-[3rem] bg-[--brand-red] text-white flex items-center justify-center font-bold text-2xl shadow-[3px_3px_0px_0px_#1a1a1a]">S</div>
                        <div class="flex flex-col justify-center h-full pt-0.5">
                            <h1 class="text-lg md:text-xl font-black leading-tight tracking-tight uppercase" data-i18n="title">CALIBRATION TFS TOOLS</h1>
                            <p class="text-[10px] sm:text-xs text-gray-500 mt-1 font-medium leading-tight max-w-[200px] sm:max-w-none" data-i18n="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏ÅTFS</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="openHelpModal()" class="shrink-0 px-3 py-1 bg-white border border-gray-300 text-gray-600 rounded font-bold text-[10px] hover:bg-gray-100 flex items-center gap-1 shadow-sm">
                            <span>üìò</span> <span id="manualBtnText">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</span>
                        </button>
                        <button onclick="toggleLang()" class="shrink-0 px-2 py-1 bg-gray-800 text-white border border-gray-800 rounded font-bold text-[10px] transition-colors" id="langBtn">TH / EN</button>
                    </div>
                </div>
                
                <div class="border-t pt-3 flex justify-end">
                    <button onclick="openAddModal()" class="w-full sm:w-auto px-6 py-3 bg-[--brand-red] text-white font-bold text-sm btn-3d rounded flex justify-center items-center gap-2">
                        <span class="text-lg leading-none">+</span> <span data-i18n="btn_add">ADD TOOL</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- CONTENT -->
        <main class="p-4 pb-20 space-y-8">
            
            <!-- ERROR DISPLAY -->
            <div id="errorState" class="hidden animate-slide-down mb-6">
                <div class="bg-white border-l-8 border-[--brand-red] shadow-lg rounded-r-lg p-6 flex flex-col gap-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-[--brand-red] font-bold text-xl">!</div>
                        <h3 class="font-black text-lg text-gray-900 uppercase">System Notification</h3>
                    </div>
                    <p class="text-sm text-gray-600 ml-11" id="errorMsg">Unknown Error</p>
                    <div class="ml-11 mt-2">
                        <button onclick="window.location.reload()" class="px-4 py-2 bg-gray-900 text-white text-xs font-bold uppercase tracking-wider rounded hover:bg-black transition-colors">
                            RELOAD SYSTEM / ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 border-2 border-gray-800 shadow-[4px_4px_0px_0px_#1f2937] rounded"><p class="text-[10px] font-black text-gray-400" data-i18n="stat_total">TOTAL</p><h3 id="statTotal" class="text-3xl font-black text-gray-800">...</h3></div>
                <div class="bg-white p-4 border-2 border-emerald-500 shadow-[4px_4px_0px_0px_#10b981] rounded"><p class="text-[10px] font-black text-emerald-600/60" data-i18n="stat_normal">NORMAL</p><h3 id="statNormal" class="text-3xl font-black text-emerald-600">...</h3></div>
                <div class="bg-white p-4 border-2 border-amber-500 shadow-[4px_4px_0px_0px_#f59e0b] rounded"><p class="text-[10px] font-black text-amber-600/60" data-i18n="stat_soon">DUE SOON</p><h3 id="statWarning" class="text-3xl font-black text-amber-500">...</h3></div>
                <div class="bg-white p-4 border-2 border-red-500 shadow-[4px_4px_0px_0px_#ef4444] rounded"><p class="text-[10px] font-black text-red-600/60" data-i18n="stat_overdue">OVERDUE</p><h3 id="statOverdue" class="text-3xl font-black text-red-600">...</h3></div>
            </div>

            <!-- Loading -->
            <div id="loadingState" class="flex flex-col items-center justify-center py-10">
                <div class="loader mb-2"></div>
                <p class="text-xs text-gray-400 animate-pulse">Connecting to Server...</p>
            </div>

            <!-- List -->
            <div id="equipmentList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden"></div>
        </main>
    </div>

    <!-- ADD MODAL -->
    <div id="addModalOverlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md max-h-[90vh] overflow-y-auto shadow-2xl rounded-lg relative border-t-8 border-[--brand-red]">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-2xl font-black uppercase tracking-tight text-gray-900" data-i18n="modal_title">ADD TOOL</h2>
                    <button onclick="closeAddModal()" class="text-gray-400 hover:text-[--brand-red] text-3xl font-bold leading-none">&times;</button>
                </div>
                
                <form id="addForm" onsubmit="submitData(event)" class="space-y-5">
                    <!-- Photo Input (Updated: Removed capture="environment" to allow gallery selection) -->
                    <div class="w-full">
                        <label class="block text-xs font-bold mb-2 text-gray-500 uppercase tracking-wider" data-i18n="label_photo">PHOTO</label>
                        <label class="block w-full h-48 bg-gray-50 border-2 border-dashed border-gray-300 hover:border-gray-500 rounded-lg cursor-pointer relative flex items-center justify-center overflow-hidden transition-colors">
                            <img id="preview" class="absolute w-full h-full object-cover hidden">
                            <div id="uploadPlaceholder" class="text-center">
                                <span class="text-4xl text-gray-300">üñºÔ∏è</span>
                                <p class="text-xs text-gray-500 mt-2 font-bold" data-i18n="tap_camera">ATTACH PHOTO</p>
                            </div>
                            <!-- Removed capture="environment" here -->
                            <input type="file" id="imgInput" accept="image/*" class="hidden" onchange="handleImage(this)">
                        </label>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-xs font-bold text-gray-500">TOOL ID *</label><input type="text" name="id" required class="w-full border p-2.5 rounded font-bold focus:border-black outline-none bg-gray-50 focus:bg-white transition-colors"></div>
                        <div><label class="text-xs font-bold text-gray-500">NAME TOOL *</label><input type="text" name="name" required class="w-full border p-2.5 rounded font-bold focus:border-black outline-none bg-gray-50 focus:bg-white transition-colors"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-xs font-bold text-gray-500">LAST DATE</label><input type="date" name="lastDate" class="w-full border p-2.5 rounded font-medium focus:border-black outline-none bg-gray-50"></div>
                        <div><label class="text-xs font-bold text-gray-500">NEXT DUE *</label><input type="date" name="nextDate" required class="w-full border p-2.5 rounded font-medium focus:border-black outline-none bg-gray-50 border-red-200"></div>
                    </div>
                    
                    <div><label class="text-xs font-bold text-gray-500">PSI *</label><input type="text" name="psi" required class="w-full border p-2.5 rounded font-bold focus:border-black outline-none bg-gray-50 focus:bg-white"></div>
                    <div><label class="text-xs font-bold text-gray-500" data-i18n="label_remarks">REMARKS</label><input type="text" name="remarks" class="w-full border p-2.5 rounded font-medium focus:border-black outline-none bg-gray-50 focus:bg-white"></div>

                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider block mb-2" data-i18n="label_pdf">ATTACH CALIBRATION DOC (PDF)</label>
                        <label class="flex items-center justify-center w-full py-3 px-4 border border-dashed border-gray-400 rounded cursor-pointer hover:bg-gray-50 transition-colors">
                            <span class="text-xl mr-2">üìé</span>
                            <span id="pdfName" class="text-xs text-gray-600 font-medium truncate">Choose PDF File...</span>
                            <input type="file" id="pdfInput" accept="application/pdf" class="hidden" onchange="handlePdf(this)">
                        </label>
                    </div>

                    <div class="pt-4 flex gap-3">
                        <button type="button" onclick="closeAddModal()" class="flex-1 py-3 border border-gray-300 font-bold text-xs uppercase tracking-wider hover:bg-gray-100 rounded" data-i18n="btn_cancel">CANCEL</button>
                        <button type="submit" id="submitBtn" class="flex-1 py-3 bg-[--brand-red] text-white font-bold text-xs uppercase tracking-wider btn-3d rounded hover:bg-[#b91c1c]" data-i18n="btn_save">SAVE</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ALERT POPUP (Schindler Theme) -->
    <div id="alertModalOverlay" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white w-full max-w-lg max-h-[85vh] flex flex-col shadow-2xl rounded-lg border-t-8 border-[--brand-red] animate-slide-down">
            <div class="p-6 border-b border-gray-100 flex justify-between items-start">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-[--brand-red] text-xl font-bold">!</div>
                    <div>
                        <h2 class="text-xl font-black uppercase tracking-tight text-gray-900" data-i18n="alert_title">ATTENTION REQUIRED</h2>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="alert_subtitle">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö / ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>
                <button onclick="closeAlertModal()" class="text-gray-400 hover:text-black font-bold text-xl">&times;</button>
            </div>
            <div class="p-2 overflow-y-auto bg-gray-50" id="alertListContainer"></div>
            <div class="p-4 border-t border-gray-200 bg-white">
                <button onclick="closeAlertModal()" class="w-full py-3 bg-[--brand-black] text-white font-bold text-sm uppercase tracking-wider btn-3d rounded hover:bg-black">
                    ACKNOWLEDGE / ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
                </button>
            </div>
        </div>
    </div>

    <!-- HELP/MANUAL MODAL -->
    <div id="helpModalOverlay" class="fixed inset-0 bg-black/80 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl rounded-lg relative border-t-8 border-blue-600">
            <div class="p-5 flex justify-between items-center border-b sticky top-0 bg-white z-10">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">üìò</span>
                    <h2 class="text-xl font-black uppercase tracking-tight text-gray-900" id="manualTitle">USER MANUAL</h2>
                </div>
                <button onclick="closeHelpModal()" class="text-gray-400 hover:text-black font-bold text-2xl">&times;</button>
            </div>
            <div class="p-6 space-y-6 manual-section">
                <div id="manualContentTH">
                    <h3>1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö (Overview)</h3>
                    <p>‡∏£‡∏∞‡∏ö‡∏ö <strong>CALIBRATION TFS TOOLS</strong> ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏±‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å TFS ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                    <h3>2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status Colors)</h3>
                    <ul>
                        <li><span class="inline-block w-3 h-3 bg-emerald-500 rounded-full mr-1"></span> <strong>‡∏õ‡∏Å‡∏ï‡∏¥ (Normal):</strong> ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô</li>
                        <li><span class="inline-block w-3 h-3 bg-amber-500 rounded-full mr-1"></span> <strong>‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏£‡∏ö (Due Soon):</strong> ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô</li>
                        <li><span class="inline-block w-3 h-3 bg-red-600 rounded-full mr-1"></span> <strong>‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î (Overdue):</strong> ‡πÄ‡∏•‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡πâ‡∏ß</li>
                    </ul>
                    <h3>3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Add Tool)</h3>
                    <ul>
                        <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>"+ ADD TOOL"</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                        <li><strong>‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢ (Photo):</strong> ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</li>
                        <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <strong>Next Due (‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î)</strong></li>
                        <li><strong>‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Calibration:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</li>
                        <li>‡∏Å‡∏î <strong>SAVE</strong> ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô Success</li>
                    </ul>
                    <h3>4. ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                    <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>üìÑ ‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Calibration</strong> ‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö)</p>
                </div>
                <div id="manualContentEN" class="hidden">
                    <h3>1. System Overview</h3>
                    <p>The <strong>CALIBRATION TFS TOOLS</strong> system manages calibration due dates. It automatically alerts users of upcoming or overdue items.</p>
                    <h3>2. Status Indicators</h3>
                    <ul>
                        <li><span class="inline-block w-3 h-3 bg-emerald-500 rounded-full mr-1"></span> <strong>Normal:</strong> > 30 days remaining.</li>
                        <li><span class="inline-block w-3 h-3 bg-amber-500 rounded-full mr-1"></span> <strong>Due Soon:</strong> <= 30 days remaining.</li>
                        <li><span class="inline-block w-3 h-3 bg-red-600 rounded-full mr-1"></span> <strong>Overdue:</strong> Calibration date passed.</li>
                    </ul>
                    <h3>3. Adding a Tool</h3>
                    <ul>
                        <li>Click <strong>"+ ADD TOOL"</strong>.</li>
                        <li><strong>Photo:</strong> Tap to select image from gallery or camera.</li>
                        <li>Fill in details, especially <strong>Next Due</strong>.</li>
                        <li><strong>Attach PDF:</strong> Upload Calibration Certificate.</li>
                        <li>Click <strong>SAVE</strong>.</li>
                    </ul>
                </div>
            </div>
            <div class="p-4 border-t bg-gray-50 text-center">
                <button onclick="closeHelpModal()" class="px-8 py-2 bg-gray-800 text-white font-bold rounded hover:bg-black btn-3d">CLOSE / ‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script>
        // **************************************************************************
        // URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy (New Deployment > Web App > Anyone)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVKnhJyBqOn8Pk9lfITsEVa3lrMUEC-lvu76V77luxZQa_WagUZg5uaEJrgdY9kGE0/exec';
        // **************************************************************************

        let currentLang = 'th';
        let rawData = [];
        let imageBase64 = null;
        let pdfBase64 = null;

        const translations = {
            en: {
                title: "CALIBRATION TFS TOOLS",
                subtitle: "Tools Calibration Management & Alert System - TFS Dept.",
                btn_add: "ADD TOOL", stat_total: "TOTAL", stat_normal: "NORMAL",
                stat_soon: "DUE SOON", stat_overdue: "OVERDUE", modal_title: "ADD TOOL", label_photo: "PHOTO",
                tap_camera: "ATTACH PHOTO", btn_cancel: "CANCEL", btn_save: "SAVE", status_over: "Overdue", 
                status_left: "Days Left", alert_title: "ATTENTION REQUIRED", alert_subtitle: "Items due within 30 days or overdue",
                label_remarks: "REMARKS", label_pdf: "ATTACH CALIBRATION DOC (PDF)", view_pdf: "VIEW CALIBRATION", manual_btn: "MANUAL"
            },
            th: {
                title: "CALIBRATION TFS TOOLS",
                subtitle: "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏ÅTFS",
                btn_add: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå", stat_total: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", stat_normal: "‡∏õ‡∏Å‡∏ï‡∏¥",
                stat_soon: "‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏£‡∏ö", stat_overdue: "‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î", modal_title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå", label_photo: "‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢",
                tap_camera: "‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ", btn_cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", btn_save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", status_over: "‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î", 
                status_left: "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å", alert_title: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", alert_subtitle: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô",
                label_remarks: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏", label_pdf: "‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Calibration (PDF)", view_pdf: "‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Calibration", manual_btn: "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠"
            }
        };

        window.onload = () => { fetchData(); updateUI(); };

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'th' : 'en';
            updateUI();
            renderList();
        }

        function updateUI() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if(translations[currentLang][key]) el.innerText = translations[currentLang][key];
            });
            document.getElementById('langBtn').innerText = currentLang === 'en' ? "EN" : "TH";
            document.getElementById('manualBtnText').innerText = translations[currentLang].manual_btn;

            const manualTH = document.getElementById('manualContentTH');
            const manualEN = document.getElementById('manualContentEN');
            const manualTitle = document.getElementById('manualTitle');

            if (currentLang === 'th') {
                manualTH.classList.remove('hidden'); manualEN.classList.add('hidden'); manualTitle.innerText = "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            } else {
                manualTH.classList.add('hidden'); manualEN.classList.remove('hidden'); manualTitle.innerText = "USER MANUAL";
            }
        }

        async function fetchData() {
            const loading = document.getElementById('loadingState');
            const errorDiv = document.getElementById('errorState');
            const errorMsg = document.getElementById('errorMsg');

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                
                const text = await response.text();
                try {
                    rawData = JSON.parse(text);
                } catch (e) {
                    throw new Error("Invalid Data Format. Script Deployment Error?");
                }

                if (rawData.status === 'error') throw new Error(rawData.message);
                if (!Array.isArray(rawData)) rawData = []; 

                rawData = rawData.map(item => {
                    const next = new Date(item.nextDate);
                    const today = new Date(); today.setHours(0,0,0,0);
                    const diffTime = next - today;
                    const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    let status = 'normal';
                    if(days < 0) status = 'overdue';
                    else if(days <= 30) status = 'warning';
                    return { ...item, days, status };
                });

                updateStats();
                renderList();
                checkDailyAlerts(rawData);
                loading.classList.add('hidden');
                document.getElementById('equipmentList').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                loading.classList.add('hidden');
                errorDiv.classList.remove('hidden');
                errorMsg.innerText = error.message;
            }
        }

        function renderList() {
            const list = document.getElementById('equipmentList');
            list.innerHTML = '';
            rawData.sort((a, b) => {
                const p = { overdue: 0, warning: 1, normal: 2 };
                return p[a.status] - p[b.status];
            });

            rawData.forEach(item => {
                let boxClass = 'box-normal', textColor = 'text-emerald-700', badgeClass = 'bg-emerald-100 text-emerald-800';
                
                if (item.status === 'overdue') { boxClass = 'box-overdue'; textColor = 'text-red-700'; badgeClass = 'bg-red-100 text-red-800'; } 
                else if (item.status === 'warning') { boxClass = 'box-warning'; textColor = 'text-amber-700'; badgeClass = 'bg-amber-100 text-amber-800'; }

                const statusText = item.status === 'overdue' ? `${Math.abs(item.days)} ${translations[currentLang].status_over}` : `${item.days} ${translations[currentLang].status_left}`;
                const imgHTML = item.image ? `<img src="${item.image}" class="w-full h-full object-cover">` : `<div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 font-bold text-xs">NO IMAGE</div>`;
                const pdfButton = item.pdf ? `<a href="${item.pdf}" target="_blank" class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-200 hover:bg-blue-100 flex items-center gap-1 mt-1">üìÑ ${translations[currentLang].view_pdf}</a>` : '';
                const remarksText = item.remarks ? `<p class="text-xs text-gray-500 italic mt-1 border-t pt-1">Note: ${item.remarks}</p>` : '';

                list.innerHTML += `
                    <div class="${boxClass} flex flex-col group h-full rounded-lg overflow-hidden relative">
                        <div class="h-48 w-full border-b-2 border-gray-100 relative bg-white">${imgHTML}
                            <div class="absolute top-2 right-2"><span class="px-2 py-1 text-xs font-black uppercase tracking-wide rounded border ${badgeClass} shadow-sm">${statusText}</span></div>
                        </div>
                        <div class="p-5 flex-1 flex flex-col">
                            <div class="flex justify-between items-start mb-1"><span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">ID: ${item.id}</span>${pdfButton}</div>
                            <h3 class="font-bold text-xl leading-tight mb-2 text-gray-900">${item.name}</h3>
                            ${remarksText}
                            <div class="mt-auto pt-4 border-t border-gray-200/50 text-sm flex justify-between items-center">
                                <div><p class="text-[10px] text-gray-400 font-black uppercase tracking-wider">PSI</p><p class="font-bold text-gray-700">${item.owner}</p></div>
                                <div class="text-right"><p class="text-[10px] text-gray-400 font-black uppercase tracking-wider">DUE</p><p class="font-bold font-mono ${textColor}">${formatDate(item.nextDate)}</p></div>
                            </div>
                        </div>
                    </div>`;
            });
        }

        function checkDailyAlerts(data) {
            const alerts = data.filter(item => item.status === 'overdue' || item.status === 'warning');
            const container = document.getElementById('alertListContainer');
            container.innerHTML = '';
            if (alerts.length > 0) {
                alerts.forEach(item => {
                    const isOverdue = item.status === 'overdue';
                    const icon = isOverdue ? 'üî¥' : 'üü°';
                    container.innerHTML += `
                        <div class="flex items-start gap-3 p-4 mb-2 bg-white border border-gray-200 shadow-sm rounded-lg hover:shadow-md transition-shadow">
                            <span class="text-lg mt-0.5">${icon}</span>
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <h4 class="font-bold text-gray-900 text-sm">${item.name}</h4>
                                    <span class="text-[10px] font-bold ${isOverdue ? 'text-red-700' : 'text-amber-700'}">${isOverdue ? 'Overdue' : 'Due Soon'}</span>
                                </div>
                                <p class="text-xs text-gray-500">ID: ${item.id} | PSI: ${item.owner}</p>
                                <p class="text-xs font-mono font-bold mt-1 text-gray-700">Due: ${formatDate(item.nextDate)}</p>
                            </div>
                        </div>`;
                });
                document.getElementById('alertModalOverlay').classList.remove('hidden');
            }
        }

        function closeAlertModal() { document.getElementById('alertModalOverlay').classList.add('hidden'); }
        function openHelpModal() { document.getElementById('helpModalOverlay').classList.remove('hidden'); }
        function closeHelpModal() { document.getElementById('helpModalOverlay').classList.add('hidden'); }
        
        function updateStats() {
            document.getElementById('statTotal').innerText = rawData.length;
            document.getElementById('statNormal').innerText = rawData.filter(i => i.status === 'normal').length;
            document.getElementById('statWarning').innerText = rawData.filter(i => i.status === 'warning').length;
            document.getElementById('statOverdue').innerText = rawData.filter(i => i.status === 'overdue').length;
        }

        function handleImage(input) {
            fileToBase64(input, (base64) => {
                imageBase64 = base64;
                document.getElementById('preview').src = base64;
                document.getElementById('preview').classList.remove('hidden');
                document.getElementById('uploadPlaceholder').classList.add('hidden');
            }, true);
        }

        function handlePdf(input) {
            if(input.files[0].size > 5*1024*1024) { alert("File too large > 5MB"); input.value=""; return; }
            document.getElementById('pdfName').innerText = input.files[0].name;
            fileToBase64(input, (base64) => { pdfBase64 = base64; }, false);
        }

        function fileToBase64(input, callback, compress) {
            if (!input.files || !input.files[0]) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                if (compress) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const cvs = document.createElement('canvas');
                        const scale = 800 / img.width;
                        cvs.width = 800; cvs.height = img.height * scale;
                        cvs.getContext('2d').drawImage(img, 0, 0, cvs.width, cvs.height);
                        callback(cvs.toDataURL('image/jpeg', 0.6));
                    };
                } else {
                    callback(e.target.result);
                }
            };
            reader.readAsDataURL(input.files[0]);
        }

        function submitData(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "UPLOADING...";
            btn.disabled = true;

            const formData = new FormData(e.target);
            const payload = {
                id: formData.get('id'), name: formData.get('name'), lastDate: formData.get('lastDate'),
                nextDate: formData.get('nextDate'), psi: formData.get('psi'), remarks: formData.get('remarks'),
                imageBase64: imageBase64, pdfBase64: pdfBase64
            };

            fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success') { alert("Success!"); closeAddModal(); fetchData(); }
                else throw new Error(data.message);
            })
            .catch(err => { alert("Error: " + err.message); })
            .finally(() => { btn.innerText = "SAVE"; btn.disabled = false; });
        }

        function openAddModal() { document.getElementById('addModalOverlay').classList.remove('hidden'); }
        function closeAddModal() { 
            document.getElementById('addModalOverlay').classList.add('hidden'); 
            document.getElementById('addForm').reset();
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
            document.getElementById('pdfName').innerText = "Choose PDF File...";
            imageBase64 = null; pdfBase64 = null;
        }
        function formatDate(d) {
            if(!d) return "-";
            const date = new Date(d);
            return `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()}`;
        }
    </script>
</body>
</html>


